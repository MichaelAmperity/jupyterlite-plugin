<!DOCTYPE html>
<html>
  <head>
    <title>JupyterLite</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="Description" content="WASM powered Jupyter running in the browser." />
    <link rel="manifest" href="../manifest.webmanifest" />
    <link
      id="jupyter-lite-main"
      rel="preload"
      href="../build/lab/bundle.js?_=8cb1e60"
      main="index"
      as="script"
    />
    <script
      id="jupyter-config-data"
      type="application/json"
      data-jupyter-lite-root=".."
    >
      {}
    </script>
    <script>
      let cellContents ="Didn't Load in time ERROR";
      (async function () {
        const { pathname, origin, search, hash } = window.location;
        if (pathname.match(/(index.html|\/)$/) == null) {
          window.location.href = `${origin}${pathname}/${search}${hash}`;
          return;
        }
        await import(
          '../config-utils.js?_=8cb1e60'
        );
      }.call(this));
      
      let InjectTimer = null;
      function delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
      function tryToInject () { 
        console.log("trying");

          if (document.querySelector('.CodeMirror') != null)
          {
            
            clearInterval(InjectTimer);
            console.log("running");

            setTimeout(async function runOnPage(){

              // set code
              document.querySelector('[data-command="notebook:change-cell-to-code"]').click();
              await delay(100);

              //need to expand to paste in code
              document.querySelector('[data-command="notebook:show-cell-code"]').click();
              await delay(100);

              // put data in
              document.querySelector('.CodeMirror').CodeMirror.setValue(cellContents);
              await delay(100);

              // run
              document.querySelector('[data-command="notebook:run-cell"]').click();
              await delay(100);

              //minimise
              document.querySelector('[data-command="notebook:hide-cell-code"]').click();
              await delay(100);

              // ctrl b
              await delay(100);
              document.querySelector('[data-command="application:toggle-left-area"]').click();
              
            }, 800);
          }

      }
      InjectTimer = setInterval(tryToInject, 200);
      
      window.addEventListener('message', 
        function (e) 
            { 
                if (e.data.populateCell)
                {
                    cellContents = e.data.populateCell;
                }
            }
        );
      
    </script>
  </head>
</html>
